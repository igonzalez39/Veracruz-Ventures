!function t(e,n,o){function i(s,u){if(!n[s]){if(!e[s]){var a="function"==typeof require&&require;if(!u&&a)return a(s,!0);if(r)return r(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[s]={exports:{}};e[s][0].call(l.exports,function(t){var n=e[s][1][t];return i(n?n:t)},l,l.exports,t,e,n,o)}return n[s].exports}for(var r="function"==typeof require&&require,s=0;s<o.length;s++)i(o[s]);return i}({1:[function(e,t,n){(function(o,i){!function(e,o){"object"==typeof n&&"undefined"!=typeof t?t.exports=o():"function"==typeof define&&define.amd?define(o):e.ES6Promise=o()}(this,function(){"use strict";function t(e){var t=typeof e;return null!==e&&("object"===t||"function"===t)}function n(e){return"function"==typeof e}function r(e){K=e}function s(e){B=e}function u(){return function(){return o.nextTick(p)}}function a(){return"undefined"!=typeof H?function(){H(p)}:f()}function c(){var e=0,t=new z(p),n=document.createTextNode("");return t.observe(n,{characterData:!0}),function(){n.data=e=++e%2}}function l(){var e=new MessageChannel;return e.port1.onmessage=p,function(){return e.port2.postMessage(0)}}function f(){var e=setTimeout;return function(){return e(p,1)}}function p(){for(var e=0;e<M;e+=2){var t=G[e],n=G[e+1];t(n),G[e]=void 0,G[e+1]=void 0}M=0}function d(){try{var e=Function("return this")().require("vertx");return H=e.runOnLoop||e.runOnContext,a()}catch(t){return f()}}function h(e,t){var n=this,o=new this.constructor(m);void 0===o[Q]&&E(o);var i=n._state;if(i){var r=arguments[i-1];B(function(){return T(i,o,r,n._result)})}else A(n,o,e,t);return o}function g(e){var t=this;if(e&&"object"==typeof e&&e.constructor===t)return e;var n=new t(m);return O(n,e),n}function m(){}function v(){return new TypeError("You cannot resolve a promise with itself")}function y(){return new TypeError("A promises callback cannot return that same promise.")}function b(e,t,n,o){try{e.call(t,n,o)}catch(i){return i}}function _(e,t,n){B(function(e){var o=!1,i=b(n,t,function(n){o||(o=!0,t!==n?O(e,n):P(e,n))},function(t){o||(o=!0,x(e,t))},"Settle: "+(e._label||" unknown promise"));!o&&i&&(o=!0,x(e,i))},e)}function w(e,t){t._state===te?P(e,t._result):t._state===ne?x(e,t._result):A(t,void 0,function(t){return O(e,t)},function(t){return x(e,t)})}function k(e,t,o){t.constructor===e.constructor&&o===h&&t.constructor.resolve===g?w(e,t):void 0===o?P(e,t):n(o)?_(e,t,o):P(e,t)}function O(e,n){if(e===n)x(e,v());else if(t(n)){var o=void 0;try{o=n.then}catch(i){return void x(e,i)}k(e,n,o)}else P(e,n)}function S(e){e._onerror&&e._onerror(e._result),j(e)}function P(e,t){e._state===ee&&(e._result=t,e._state=te,0!==e._subscribers.length&&B(j,e))}function x(e,t){e._state===ee&&(e._state=ne,e._result=t,B(S,e))}function A(e,t,n,o){var i=e._subscribers,r=i.length;e._onerror=null,i[r]=t,i[r+te]=n,i[r+ne]=o,0===r&&e._state&&B(j,e)}function j(e){var t=e._subscribers,n=e._state;if(0!==t.length){for(var o=void 0,i=void 0,r=e._result,s=0;s<t.length;s+=3)o=t[s],i=t[s+n],o?T(n,o,i,r):i(r);e._subscribers.length=0}}function T(e,t,o,i){var r=n(o),s=void 0,u=void 0,a=!0;if(r){try{s=o(i)}catch(c){a=!1,u=c}if(t===s)return void x(t,y())}else s=i;t._state!==ee||(r&&a?O(t,s):a===!1?x(t,u):e===te?P(t,s):e===ne&&x(t,s))}function C(e,t){try{t(function(t){O(e,t)},function(t){x(e,t)})}catch(n){x(e,n)}}function D(){return oe++}function E(e){e[Q]=oe++,e._state=void 0,e._result=void 0,e._subscribers=[]}function I(){return new Error("Array Methods must be provided an Array")}function L(e){return new ie(this,e).promise}function N(e){var t=this;return new t(V(e)?function(n,o){for(var i=e.length,r=0;r<i;r++)t.resolve(e[r]).then(n,o)}:function(e,t){return t(new TypeError("You must pass an array to race."))})}function R(e){var t=this,n=new t(m);return x(n,e),n}function q(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function U(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function F(){var e=void 0;if("undefined"!=typeof i)e=i;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(t){throw new Error("polyfill failed because global object is unavailable in this environment")}var n=e.Promise;if(n){var o=null;try{o=Object.prototype.toString.call(n.resolve())}catch(t){}if("[object Promise]"===o&&!n.cast)return}e.Promise=re}var W=void 0;W=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};var V=W,M=0,H=void 0,K=void 0,B=function(e,t){G[M]=e,G[M+1]=t,M+=2,2===M&&(K?K(p):Z())},X="undefined"!=typeof window?window:void 0,$=X||{},z=$.MutationObserver||$.WebKitMutationObserver,J="undefined"==typeof self&&"undefined"!=typeof o&&"[object process]"==={}.toString.call(o),Y="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,G=new Array(1e3),Z=void 0;Z=J?u():z?c():Y?l():void 0===X&&"function"==typeof e?d():f();var Q=Math.random().toString(36).substring(2),ee=void 0,te=1,ne=2,oe=0,ie=function(){function e(e,t){this._instanceConstructor=e,this.promise=new e(m),this.promise[Q]||E(this.promise),V(t)?(this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?P(this.promise,this._result):(this.length=this.length||0,this._enumerate(t),0===this._remaining&&P(this.promise,this._result))):x(this.promise,I())}return e.prototype._enumerate=function(e){for(var t=0;this._state===ee&&t<e.length;t++)this._eachEntry(e[t],t)},e.prototype._eachEntry=function(e,t){var n=this._instanceConstructor,o=n.resolve;if(o===g){var i=void 0,r=void 0,s=!1;try{i=e.then}catch(u){s=!0,r=u}if(i===h&&e._state!==ee)this._settledAt(e._state,t,e._result);else if("function"!=typeof i)this._remaining--,this._result[t]=e;else if(n===re){var a=new n(m);s?x(a,r):k(a,e,i),this._willSettleAt(a,t)}else this._willSettleAt(new n(function(t){return t(e)}),t)}else this._willSettleAt(o(e),t)},e.prototype._settledAt=function(e,t,n){var o=this.promise;o._state===ee&&(this._remaining--,e===ne?x(o,n):this._result[t]=n),0===this._remaining&&P(o,this._result)},e.prototype._willSettleAt=function(e,t){var n=this;A(e,void 0,function(e){return n._settledAt(te,t,e)},function(e){return n._settledAt(ne,t,e)})},e}(),re=function(){function e(t){this[Q]=D(),this._result=this._state=void 0,this._subscribers=[],m!==t&&("function"!=typeof t&&q(),this instanceof e?C(this,t):U())}return e.prototype["catch"]=function(e){return this.then(null,e)},e.prototype["finally"]=function(e){var t=this,o=t.constructor;return n(e)?t.then(function(t){return o.resolve(e()).then(function(){return t})},function(t){return o.resolve(e()).then(function(){throw t})}):t.then(e,e)},e}();return re.prototype.then=h,re.all=L,re.race=N,re.resolve=g,re.reject=R,re._setScheduler=r,re._setAsap=s,re._asap=B,re.polyfill=F,re.Promise=re,re})}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:5}],2:[function(e,t,n){n.parse=e("./lib/parse"),n.stringify=e("./lib/stringify")},{"./lib/parse":3,"./lib/stringify":4}],3:[function(e,t,n){var o,i,r,s,u={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"},a=function(e){throw{name:"SyntaxError",message:e,at:o,text:r}},c=function(e){return e&&e!==i&&a("Expected '"+e+"' instead of '"+i+"'"),i=r.charAt(o),o+=1,i},l=function(){var e,t="";for("-"===i&&(t="-",c("-"));i>="0"&&i<="9";)t+=i,c();if("."===i)for(t+=".";c()&&i>="0"&&i<="9";)t+=i;if("e"===i||"E"===i)for(t+=i,c(),"-"!==i&&"+"!==i||(t+=i,c());i>="0"&&i<="9";)t+=i,c();return e=+t,isFinite(e)?e:void a("Bad number")},f=function(){var e,t,n,o="";if('"'===i)for(;c();){if('"'===i)return c(),o;if("\\"===i)if(c(),"u"===i){for(n=0,t=0;t<4&&(e=parseInt(c(),16),isFinite(e));t+=1)n=16*n+e;o+=String.fromCharCode(n)}else{if("string"!=typeof u[i])break;o+=u[i]}else o+=i}a("Bad string")},p=function(){for(;i&&i<=" ";)c()},d=function(){switch(i){case"t":return c("t"),c("r"),c("u"),c("e"),!0;case"f":return c("f"),c("a"),c("l"),c("s"),c("e"),!1;case"n":return c("n"),c("u"),c("l"),c("l"),null}a("Unexpected '"+i+"'")},h=function(){var e=[];if("["===i){if(c("["),p(),"]"===i)return c("]"),e;for(;i;){if(e.push(s()),p(),"]"===i)return c("]"),e;c(","),p()}}a("Bad array")},g=function(){var e,t={};if("{"===i){if(c("{"),p(),"}"===i)return c("}"),t;for(;i;){if(e=f(),p(),c(":"),Object.hasOwnProperty.call(t,e)&&a('Duplicate key "'+e+'"'),t[e]=s(),p(),"}"===i)return c("}"),t;c(","),p()}}a("Bad object")};s=function(){switch(p(),i){case"{":return g();case"[":return h();case'"':return f();case"-":return l();default:return i>="0"&&i<="9"?l():d()}},t.exports=function(e,t){var n;return r=e,o=0,i=" ",n=s(),p(),i&&a("Syntax error"),"function"==typeof t?function u(e,n){var o,i,r=e[n];if(r&&"object"==typeof r)for(o in r)Object.prototype.hasOwnProperty.call(r,o)&&(i=u(r,o),void 0!==i?r[o]=i:delete r[o]);return t.call(e,n,r)}({"":n},""):n}},{}],4:[function(e,t,n){function o(e){return a.lastIndex=0,a.test(e)?'"'+e.replace(a,function(e){var t=c[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function i(e,t){var n,a,c,l,f,p=r,d=t[e];switch(d&&"object"==typeof d&&"function"==typeof d.toJSON&&(d=d.toJSON(e)),"function"==typeof u&&(d=u.call(t,e,d)),typeof d){case"string":return o(d);case"number":return isFinite(d)?String(d):"null";case"boolean":case"null":return String(d);case"object":if(!d)return"null";if(r+=s,f=[],"[object Array]"===Object.prototype.toString.apply(d)){for(l=d.length,n=0;n<l;n+=1)f[n]=i(n,d)||"null";return c=0===f.length?"[]":r?"[\n"+r+f.join(",\n"+r)+"\n"+p+"]":"["+f.join(",")+"]",r=p,c}if(u&&"object"==typeof u)for(l=u.length,n=0;n<l;n+=1)a=u[n],"string"==typeof a&&(c=i(a,d),c&&f.push(o(a)+(r?": ":":")+c));else for(a in d)Object.prototype.hasOwnProperty.call(d,a)&&(c=i(a,d),c&&f.push(o(a)+(r?": ":":")+c));return c=0===f.length?"{}":r?"{\n"+r+f.join(",\n"+r)+"\n"+p+"}":"{"+f.join(",")+"}",r=p,c}}var r,s,u,a=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,c={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};t.exports=function(e,t,n){var o;if(r="",s="","number"==typeof n)for(o=0;o<n;o+=1)s+=" ";else"string"==typeof n&&(s=n);if(u=t,t&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw new Error("JSON.stringify");return i("",{"":e})}},{}],5:[function(e,t,n){function o(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function r(e){if(f===setTimeout)return setTimeout(e,0);if((f===o||!f)&&setTimeout)return f=setTimeout,setTimeout(e,0);try{return f(e,0)}catch(t){try{return f.call(null,e,0)}catch(t){return f.call(this,e,0)}}}function s(e){if(p===clearTimeout)return clearTimeout(e);if((p===i||!p)&&clearTimeout)return p=clearTimeout,clearTimeout(e);try{return p(e)}catch(t){try{return p.call(null,e)}catch(t){return p.call(this,e)}}}function u(){m&&h&&(m=!1,h.length?g=h.concat(g):v=-1,g.length&&a())}function a(){if(!m){var e=r(u);m=!0;for(var t=g.length;t;){for(h=g,g=[];++v<t;)h&&h[v].run();v=-1,t=g.length}h=null,m=!1,s(e)}}function c(e,t){this.fun=e,this.array=t}function l(){}var f,p,d=t.exports={};!function(){try{f="function"==typeof setTimeout?setTimeout:o}catch(e){f=o}try{p="function"==typeof clearTimeout?clearTimeout:i}catch(e){p=i}}();var h,g=[],m=!1,v=-1;d.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];g.push(new c(e,t)),1!==g.length||m||r(a)},c.prototype.run=function(){this.fun.apply(null,this.array)},d.title="browser",d.browser=!0,d.env={},d.argv=[],d.version="",d.versions={},d.on=l,d.addListener=l,d.once=l,d.off=l,d.removeListener=l,d.removeAllListeners=l,d.emit=l,d.prependListener=l,d.prependOnceListener=l,d.listeners=function(e){return[]},d.binding=function(e){throw new Error("process.binding is not supported")},d.cwd=function(){return"/"},d.chdir=function(e){throw new Error("process.chdir is not supported")},d.umask=function(){return 0}},{}],6:[function(e,t,n){(function(e){var n,o=e.crypto||e.msCrypto;if(o&&o.getRandomValues){var i=new Uint8Array(16);n=function(){return o.getRandomValues(i),i}}if(!n){var r=new Array(16);n=function(){for(var e,t=0;t<16;t++)0===(3&t)&&(e=4294967296*Math.random()),r[t]=e>>>((3&t)<<3)&255;return r}}t.exports=n}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],7:[function(e,t,n){function o(e,t,n){var o=t&&n||0,i=0;for(t=t||[],e.toLowerCase().replace(/[0-9a-f]{2}/g,function(e){i<16&&(t[o+i++]=c[e])});i<16;)t[o+i++]=0;return t}function i(e,t){var n=t||0,o=a;return o[e[n++]]+o[e[n++]]+o[e[n++]]+o[e[n++]]+"-"+o[e[n++]]+o[e[n++]]+"-"+o[e[n++]]+o[e[n++]]+"-"+o[e[n++]]+o[e[n++]]+"-"+o[e[n++]]+o[e[n++]]+o[e[n++]]+o[e[n++]]+o[e[n++]]+o[e[n++]]}function r(e,t,n){var o=t&&n||0,r=t||[];e=e||{};var s=void 0!==e.clockseq?e.clockseq:d,u=void 0!==e.msecs?e.msecs:(new Date).getTime(),a=void 0!==e.nsecs?e.nsecs:g+1,c=u-h+(a-g)/1e4;if(c<0&&void 0===e.clockseq&&(s=s+1&16383),(c<0||u>h)&&void 0===e.nsecs&&(a=0),a>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");h=u,g=a,d=s,u+=122192928e5;var l=(1e4*(268435455&u)+a)%4294967296;r[o++]=l>>>24&255,r[o++]=l>>>16&255,r[o++]=l>>>8&255,r[o++]=255&l;var f=u/4294967296*1e4&268435455;r[o++]=f>>>8&255,r[o++]=255&f,r[o++]=f>>>24&15|16,r[o++]=f>>>16&255,r[o++]=s>>>8|128,r[o++]=255&s;for(var m=e.node||p,v=0;v<6;v++)r[o+v]=m[v];return t?t:i(r)}function s(e,t,n){var o=t&&n||0;"string"==typeof e&&(t="binary"==e?new Array(16):null,e=null),e=e||{};var r=e.random||(e.rng||u)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t)for(var s=0;s<16;s++)t[o+s]=r[s];return t||i(r)}for(var u=e("./rng"),a=[],c={},l=0;l<256;l++)a[l]=(l+256).toString(16).substr(1),c[a[l]]=l;var f=u(),p=[1|f[0],f[1],f[2],f[3],f[4],f[5]],d=16383&(f[6]<<8|f[7]),h=0,g=0,m=s;m.v1=r,m.v4=s,m.parse=o,m.unparse=i,t.exports=m},{"./rng":6}],8:[function(e,t,n){"use strict";function o(e){"@babel/helpers - typeof";return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var i=function(e){var t=function n(e,t,o){return 1===arguments.length?n.get(e):n.set(e,t,o)};return t._document=document,t._navigator=navigator,t.defaults={path:"/"},t.get=function(e){return t._cachedDocumentCookie!==t._document.cookie&&t._renewCache(),t._cache[e]},t.set=function(n,o,i){return i=t._getExtendedOptions(i),i.expires=t._getExpiresDate(o===e?-1:i.expires),t._document.cookie=t._generateCookieString(n,o,i),t},t.expire=function(n,o){return t.set(n,e,o)},t._getExtendedOptions=function(n){return{path:n&&n.path||t.defaults.path,domain:n&&n.domain||t.defaults.domain,expires:n&&n.expires||t.defaults.expires,secure:n&&n.secure!==e?n.secure:t.defaults.secure}},t._isValidDate=function(e){return"[object Date]"===Object.prototype.toString.call(e)&&!isNaN(e.getTime())},t._getExpiresDate=function(e,n){switch(n=n||new Date,o(e)){case"number":e=new Date(n.getTime()+1e3*e);break;case"string":e=new Date(e)}if(e&&!t._isValidDate(e))throw new Error("`expires` parameter cannot be converted to a valid Date instance");return e},t._generateCookieString=function(e,t,n){e=e.replace(/[^#$&+\^`|]/g,encodeURIComponent),e=e.replace(/\(/g,"%28").replace(/\)/g,"%29"),t=(t+"").replace(/[^!#$&-+\--:<-\[\]-~]/g,encodeURIComponent),n=n||{};var o=e+"="+t;return o+=n.path?";path="+n.path:"",o+=n.domain?";domain="+n.domain:"",o+=n.expires?";expires="+n.expires.toUTCString():"",o+=";Secure",o+=";SameSite=None"},t._getCookieObjectFromString=function(n){for(var o={},i=n?n.split("; "):[],r=0;r<i.length;r++){var s=t._getKeyValuePairFromCookieString(i[r]);o[s.key]===e&&(o[s.key]=s.value)}return o},t._getKeyValuePairFromCookieString=function(e){var t=e.indexOf("=");return t=t<0?e.length:t,{key:decodeURIComponent(e.substr(0,t)),value:decodeURIComponent(e.substr(t+1))}},t._renewCache=function(){t._cache=t._getCookieObjectFromString(t._document.cookie),t._cachedDocumentCookie=t._document.cookie},t._areEnabled=function(){var e="cookies.js",n="1"===t.set(e,1).get(e);return t.expire(e),n},t.enabled=t._areEnabled(),t},r={getItem:function(e){return""},setItem:function(e,t){},removeItem:function(e){}},s=function(){return{cookies:"undefined"==typeof document?r:i()}};t.exports=s},{}],9:[function(t,n,o){"use strict";function i(t,n){return new Promise(function(o,i){var r=indexedDB.open("loca");r.onupgradeneeded=function(e){var t=e.target.result,n=t.createObjectStore("loca",{keyPath:"key"});n.createIndex("key","key",{unique:!0}),n.transaction.oncomplete=function(e){t.transaction("loca","readwrite").objectStore("loca")}},r.onerror=function(e){console.log("onerror with open",n),i({event:e,operation:t,data:n,message:"unable to open connection"})},r.onsuccess=function(r){if(t){var s=r.target.result,u=s.transaction("loca","readwrite").objectStore("loca");if(u[t]){var a=u[t](n);a.onerror=function(e){i({event:e,operation:t,data:n,message:"error with operation"})},a.onsuccess=function(e){o(e.target.result)}}else i({event:e,operation:t,data:n,message:"unsupported operation: ".concat(t)})}}})}function r(e){return i("get",e)}function s(e){return i("add",e)}function u(e){return i("put",e)}function a(e){return i("delete",e)}n.exports={indexedDBOP:i,get:r,add:s,put:u,"delete":a}},{}],10:[function(e,t,n){"use strict";var o=function(e){function t(e,t,n){var o,i;n?(o=new Date,o.setTime(o.getTime()+24*n*60*60*1e3),i="; expires="+o.toGMTString()):i="",document.cookie=e+"="+t+i+"; Secure; SameSite=None; path=/"}function n(e){var t,n,o=e+"=",i=document.cookie.split(";");for(t=0;t<i.length;t++){for(n=i[t];" "==n.charAt(0);)n=n.substring(1,n.length);if(0==n.indexOf(o))return n.substring(o.length,n.length).replace(/'/g,'"')}return null}function o(n){n=JSON.stringify(n).replace(/"/g,"'"),"session"==e?window.name=n:t("localStorage",n,365)}function i(){"session"==e?window.name="":t("localStorage","",365)}function r(){var t="session"==e?window.name:n("localStorage");return t?JSON.parse(t):{}}var s=r();return{length:0,clear:function(){s={},this.length=0,i()},getItem:function(e){return void 0===s[e]?null:s[e]},key:function(e){var t=0;for(var n in s){if(t==e)return n;t++}return null},removeItem:function(e){delete s[e],this.length--,o(s)},setItem:function(e,t){s[e]=t+"",this.length++,o(s)}}},i=function(){if("undefined"==typeof window){var e={getItem:function(e){return""},setItem:function(e,t){},removeItem:function(e){}};return e}return{localStorage:"undefined"==typeof window.localStorage?new o("local"):window.localStorage,sessionStorage:"undefined"==typeof window.sessionStorage?new o("session"):window.sessionStorage}};t.exports=i},{}],11:[function(e,t,n){(function(t){"use strict";function n(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,o)}return n}function o(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?n(Object(o),!0).forEach(function(t){i(e,t,o[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):n(Object(o)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))})}return e}function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){if(null==e)return{};var n,o,i=s(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}function s(e,t){if(null==e)return{};var n,o,i={},r=Object.keys(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||(i[n]=e[n]);return i}function u(e){"@babel/helpers - typeof";return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}e("./shim"),e("es6-promise").polyfill();var a=e("jsonify"),c=e("uuid"),l=e("./cookie")().cookies,f=e("./network"),p=e("./localStorage")().localStorage,d=e("./webpush"),h=e("./webpush-utils"),g=e("./indexedDB"),m="web_4.2.0",v=t[t.LocalyticsGlobal],y="undefined"!=typeof v?v.q:[],b="undefined"!=typeof document?document:{title:"ServiceWorker"},w="undefined"!=typeof v?v.d||100:100,k="undefined"!=typeof v?v.t/1e3|0:0,O="undefined"!=typeof t.location?"https:"==t.location.protocol?"https:":"http:":"https",S=O+"//webanalytics.localytics.com/api/v2/applications/",P="https://profile.localytics.com/v1/apps/",x={},A=524288,j=function(){return Date.now?Date.now():(new Date).getTime()},T=function(){return j()/1e3|0},C=encodeURIComponent,D=a.stringify,E=Array.isArray,I=function(e){return decodeURIComponent((new RegExp("[?|&]"+e+"=([^&;]+?)(&|#|;|$)").exec(location.search)||[,""])[1].replace(/\+/g,"%20"))||null},L=function(e){for(var t=Array.prototype.slice.call(arguments,1),n=0;n<t.length;n++)for(var o in t[n])t[n].hasOwnProperty(o)&&(e[o]=t[n][o]);return e},N={},R=Array.prototype.forEach,q=function(e,t,n){if(null==e)return e;if(R&&e.forEach===R)e.forEach(t,n);else if(e.length===+e.length){for(var o=0,i=e.length;o<i;o++)if(t.call(n,e[o],o,e)===N)return}else for(var r=_.keys(e),o=0,i=r.length;o<i;o++)if(t.call(n,e[r[o]],r[o],e)===N)return;return e},U=function(e){return"string"==typeof e||e instanceof String},F=function(e){var t=e[0]instanceof Date?Date:u(e[0]);return e.every(function(e){return t===(e instanceof Date?Date:u(e))})},W=function(e){return e instanceof Date||U(e)||"number"==typeof V(e)},V=function(e){return 0===e?0:!(isNaN(+e)||"boolean"==typeof e||e instanceof Boolean||(e=+e,"number"!=typeof e||isNaN(e)||!isFinite(e)||0===e))&&e},M=function(e){return e<10?"0"+e:e},H=function(e){return e.getUTCFullYear()+"-"+M(e.getUTCMonth()+1)+"-"+M(e.getUTCDate())},K=function(e){var t=[];return e.map(function(e){t.indexOf(e)===-1&&t.push(e)}),t},B=function(){return c.v4()},X=function ee(){try{if(y&&y.length){var e=y[0][0].split("."),t=e[0],n=e[1]||"";("init"===t||x[n])&&!function(e){var t=e[0].split(".")[1]||"",n=J[t]||function(){var n="init extend",o=e[0].split(".")[0];if(1==n.split(o).length)throw new Error("You must call init before calling "+o);return J[t]=new Z(t)}(),o=e.splice(0,1)[0].split(".")[0];try{o in n&&n[o].apply(n,e)}catch(i){console.error(i)}}(Array.prototype.slice.apply(y.splice(0,1)[0]))}}catch(o){}setTimeout(ee,w)},$={cookies:"file:"!=t.location.protocol&&navigator.cookieEnabled||function(e){b.cookie=e+"=1";var t=b.cookie.indexOf(e+"=")!=-1;return b.cookie=e+"=1; expires=Thu, 01-Jan-1970 00:00:01 GMT",t}(B())},z={trackPageView:!1,sessionTimeout:1800,disableAnalyticsTracking:!1},J=[],Y={install_uuid:"iu",event_store:"es",current_header:"ch",device_birth_time:"pa",session_uuid:"csu",session_open_time:"cst",session_action_time:"ct",session_index:"csi",sequence_index:"csq",last_open_time:"lot",last_close_time:"lct",screen_flows:"fl",custom_dimensions:"cd",identifiers:"ids",upload_queue:"que",push_token:"push",push_enabled:"ne",disable_analytics_tracking:"dat",privacy_opt_out:"p_out",opted_out:"opt"},G=function(){var e,t=navigator.userAgent,n=t.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];return/trident/i.test(n[1])?(e=/\brv[ :]+(\d+)/g.exec(t)||[],{name:"IE",version:e[1]||""}):"Chrome"===n[1]&&(e=t.match(/\bOPR\/(\d+)/),null!=e)?{name:"Opera",version:e[1]}:(n=n[2]?[n[1],n[2]]:[navigator.appName,navigator.appVersion,"-?"],null!=(e=t.match(/version\/(\d+)/i))&&n.splice(1,1,e[1]),{name:n[0],version:n[1]})}(),Z=function(e){return this.namespace=e||"",this},Q=Z.prototype;L(Q,{storage:function(){var e=this._storage(),t=this,n="_loc_"+(t.namespace?t.namespace+"_":"");return"undefined"==typeof indexedDB?e:{get:function(o){var i="".concat(n).concat(o);return g.get(i).then(function(e){return e?e.value:(t.options.allowLogs&&console.log("Unable to find value for key: ".concat(i)),null)},function(n){return t.options.allowLogs&&console.error(n),t.options.sw?null:e.get(o)})},getPrefix:e.getPrefix,set:function(o,i){var r="".concat(n).concat(o);return t.options.sw||e.set(o,i),g.put({key:r,value:i})},getOrSet:function(o,i){var r="".concat(n).concat(o);return t.options.sw||e.getOrSet(o,i),g.get(r).then(function(e){return e?e.value:(g.put({key:r,value:i}),i)},function(n){if(!t.options.sw)return e.get(o)})},remove:function(o){var i="".concat(n).concat(o);return t.options.sw||e.remove(o),g["delete"](i)},increment:function(o){var i="".concat(n).concat(o);if(!t.options.sw){e.increment(o)}return g.get(i).then(function(e){if(e){var n=parseInt(e.value)+1;return Number.isNaN(n)?(t.options.allowLogs&&console.error("".concat(i," had value ").concat(e.value,", parsed as NaN")),0):(g.put({key:i,value:n}),n)}return g.put({key:i,value:0}),0},function(e){return null})}}},_storage:function(){var e=this,t="_loc_"+(e.namespace?e.namespace+"_":"");return{get:function(n){var o;return o=e.options.cookies?l.get(t+n):p.getItem(t+n),new Promise(function(e,t){e(o&&a.parse(o))})},set:function(n,o){return e.options.cookies?l.set(t+n,a.stringify(o)):p.setItem(t+n,a.stringify(o)),new Promise(function(e,t){e(o)})},remove:function(n){return e.options.cookies?l.expire(t+n):p.removeItem(t+n),new Promise(function(e,t){return 0})},getOrSet:function(t,n){var o=this;return e._storage().get(t).then(function(e){return null===e||"undefined"==typeof e?new Promise(function(e,i){e(o.set(t,n))}):new Promise(function(t,n){t(e)})})},increment:function(e){var t=this;return this.getOrSet(e,0).then(function(n){var o=parseInt(n);return t.set(e,++o)})},getPrefix:function(){return t}}},queue:function(){var e=this,t=[];return e.options.cacheOffline&&e.storage().getOrSet(Y.upload_queue,[]).then(function(e){t=e}),{list:function(){return t},flush:function(){var e=t;return t=[],this.save(),e},enqueue:function(e){t.push(e),this.save()},save:function(){if(e.options.cacheOffline){var n=2*t.join("").length;n<=A&&e.storage().set(Y.upload_queue,t)}}}},identity:function(){var e,t,n,o=this;return{init:function(){var i,r=function(){return!!$.cookies&&l.get("__ll_"+(o.namespace?o.namespace:"")+Y.install_uuid)}()||B();return i=o.options.installId?o.options.installId:r.replace(/\"/g,""),o.storage().getOrSet(Y.install_uuid,i).then(function(t){return e=t,o.storage().getOrSet(Y.identifiers,{})}).then(function(t){n=t.customer_id||e;var i=function(){return!!$.cookies&&l.get("__ll_"+(o.namespace?o.namespace:"")+Y.device_birth_time)}()||k;return o.storage().getOrSet(Y.device_birth_time,i)}).then(function(e){return t=t,!0})},uuid:function(){return e},birthTime:function(){return t},customerId:function(){return o.storage().get(Y.identifiers).then(function(t){return t&&t.customer_id?t.customer_id:e})},setCustomerId:function(e){n=e,o.setIdentifier("customer_id",e)},isAnonymousUser:function(t){return t===e}}},session:function(){var e=this;return{uuid:function(){return this.sessionUUID||""},openTime:function(){return Math.floor(this.open)},index:function(){return this.sessionIndex},actionTime:function(){return Math.floor(this.action)},updateActionTime:function(){return this._updateActionTime(Date.now()/1e3)},initialize:function(){var t=this;return e.options.sw?Promise.resolve(0):this._updateLocalVariables().then(function(){return e.storage().get(Y.opted_out)}).then(function(e){e||t._updateActionTime(k)})},destroy:function(){if(e.options.sw)return Promise.resolve(0);var t=this;return Promise.all([e.storage().remove(Y.session_uuid),e.storage().remove(Y.session_open_time),e.storage().remove(Y.screen_flows)]).then(function(e){return t._updateLocalVariables()})},create:function(t){if(e.options.sw)return Promise.resolve(0);var n=this;return Promise.all([e.storage().set(Y.session_uuid,B()),e.storage().increment(Y.session_index),e.storage().set(Y.session_open_time,t)]).then(function(t){return n._updateLocalVariables(),e.identity.customerId()}).then(function(t){var o={dt:"s",ct:T(),u:n.uuid(),nth:n.index(),mc:I("utm_campaign"),mm:I("utm_medium"),ms:I("utm_source"),cid:t,utp:e.identity.isAnonymousUser(t)?"anonymous":"known"};e._upload(o)})},exists:function(){return!e.options.sw&&this.sessionExists},addScreen:function(t){e.options.sw||(this.flows[this.flows.length-1]!=t&&this.flows.push(t),e.storage().set(Y.screen_flows,this.flows))},screens:function(){return e.options.sw?[]:this.flows},_updateActionTime:function(t){if(e.options.sw)return Promise.resolve(0);var n=Date.now()/1e3,o=this.action;return this.action=n,!o||o<n-e.options.sessionTimeout?e.storage().set(Y.session_action_time,this.action).then(function(t){return e.close()}).then(function(n){return e.session.create(t)}):e.storage().set(Y.session_action_time,this.action)},_updateLocalVariables:function(){var t=this;return Promise.all([e.storage().get(Y.session_open_time),e.storage().get(Y.session_action_time),e.storage().get(Y.session_uuid),e.storage().get(Y.session_index),e.storage().getOrSet(Y.screen_flows,[])]).then(function(e){t.open=e[0],t.action=e[1],t.sessionUUID=e[2],t.sessionExists=!!e[2],t.sessionIndex=e[3],t.flows=e[4]})}}},device:function(){return{language:(navigator.language||navigator.userLanguage||"").toUpperCase(),platform:navigator.platform,make:navigator.vendor,model:navigator.platform}},extend:function(){q(arguments,function(e){L(Q,e)})}}),L(Q,{_url:function(e){var t=[];return q(e,function(e,n){t.push(D(e))}),t=t.join("\n"),[S,this.options.appKey,"/uploads/image.gif?client_date=",T(),"&callback=z&data=",C(t)].join("")},_upload:function(e){var t=this;this.storage().getOrSet(Y.custom_dimensions,[]).then(function(n){return L(e,function(e,t){for(var n=0;n<e.length;n++)"undefined"!=typeof e[n]&&(t["c"+n]=e[n]);return t}(n,{})),t._header()}).then(function(n){var o=[n,e];t.options.autoUpload?t.storage().get(Y.disable_analytics_tracking).then(function(e){e||t.upload(o)}):t.queue().enqueue(o)})},_commonData:function(e){var t=this;return L({ct:T(),u:B(),su:t.session.uuid(),mc:I("utm_campaign"),mm:I("utm_medium"),ms:I("utm_source")},e)},_header:function(){var e=this,t={dt:"h",pa:e.identity.birthTime(),u:B(),attrs:{dt:"a",au:e.options.appKey,iu:e.identity.uuid(),lv:m,dmo:e.device().platform,dll:e.device().language,dma:e.device().make,tz:60*(new Date).getTimezoneOffset()}};return Intl&&(t.attrs.tzid=Intl.DateTimeFormat().resolvedOptions().timeZone),this.options.appVersion&&(t.attrs.av=this.options.appVersion),e.storage().get(Y.push_enabled).then(function(n){return t.attrs.ne=n,e.storage().get(Y.push_token)}).then(function(n){return t.attrs.push=n,e.storage().increment(Y.sequence_index)}).then(function(n){return t.seq=n,e.storage().getOrSet(Y.identifiers,{})}).then(function(e){return t.ids=e,t})},_get:function(e){var t=this,n=function(e){this.queue().enqueue(e)}.bind(t,e);f.get(this._url(e),n)},_post:function(e){var t=this,n=e.map(function(e){return e.map(function(e){return a.stringify(e)}).join("\n")}).join("\n"),o=function(e){q(e,function(e){this.queue().enqueue(e)})}.bind(t,e);f.post([S,this.options.appKey,"/uploads"].join(""),n,T(),o)},_postProfile:function(e,t,n,o){var i=this;!U(t)||E(n)&&!n.every(W)||!E(n)&&!W(n)||this.identity.customerId().then(function(r){var s=[["x-customer-id",r],["x-install-id",i.identity.uuid()]];E(n)?(F(n)||(n=n.map(function(e){return e instanceof Date?H(e):e.toString()})),n[0]instanceof Date&&(n=n.map(function(e){return H(e)})),n=K(n).map(function(e){return e instanceof String?e.toString():e})):n instanceof Date?n=H(n):n instanceof String&&(n=n.toString());var u={database:o&&"app"===o?"app":"org",changes:[{op:e,attr:t.toString()}]};"delete"!==e&&(u.changes[0].value=n);var a=C(r);f.post([P,i.options.appKey,"/profiles/",a].join(""),D(u),T(),!1,s)})}}),L(Q,{init:function(e,t){
this.options=L({},z,t),this.options.appKey=e,this.options.domain&&$.cookies&&(l.defaults.domain=this.options.domain,this.options.cookies=!0),$.cookies&&(l.defaults.expires=31536e4),this.options.sw||"localStorage"in window||(this.options.cookies=!0);var n=this;if(this.options.customDimensions&&Array.isArray(this.options.customDimensions)&&n.storage().set(Y.custom_dimensions,this.options.customDimensions.slice(0,20)),q(["customerEmail","customerId","customerName"],function(e,t){n.options[e]&&n["set"+e[0].toUpperCase()+e.slice(1)](n.options[e])}),this.options.useXHR=this.options.useXHR||this.options.cacheOffline||!1,this.options.autoUpload=this.options.autoUpload!==!1,this.options.sw||(void 0!==("undefined"==typeof fetch?"undefined":u(fetch))&&"undefined"!=typeof XMLHttpRequest&&("withCredentials"in new XMLHttpRequest||"undefined"!=typeof XDomainRequest)||(this.options.useXHR=!1,this.options.cacheOffline=!1),"msie"==G.name.toLowerCase()&&G.version<=9&&(this.options.useXHR=!1,this.options.cacheOffline=!1)),this.options.workerPath=this.options.workerPath||"/",this.options.workerName=this.options.workerName||"worker.js",this.options.allowLogs=!!this.options.allowLogs,!this.options.sw){var n=this;"Notification"in window&&"granted"===Notification.permission?this.storage().get(Y.push_token).then(function(e){n.storage().set(Y.push_enabled,!!e)}):this.storage().set(Y.push_enabled,!1)}this.storage().set(Y.disable_analytics_tracking,this.options.disableAnalyticsTracking),"optedOut"in this.options&&this.storage.set(Y.opted_out,this.options.optedOut),"privacyOptedOut"in this.options&&this.storage.set(Y.privacy_opt_out,this.options.privacyOptedOut),this.identity=this.identity(),this.session=this.session();var n=this;this.identity.init().then(function(e){return n.session.initialize()}).then(function(e){x[n.namespace]=!0,n.options.trackPageView&&n.trackPageView()})},initFromServiceWorker:function(e,t){t.domain=null,t.cookies=!1,t.useXHR=!0,t.cacheOffline=!0,t.autoUpload=!0,t.trackPageView=!1,t.sw=!0,$.cookies=!1,this.init(e,t)},open:function(){var e=this;if(!this.options.sw)return this.session.exists()?void(this.options.allowLogs&&console.log("Localytics cant open session - a session is already open")):void this.storage().get(Y.opted_out).then(function(t){return t?(e.options.allowLogs&&console.log("Data collection is opted out"),Promise.reject("Data collection is opted out")):void e.session.create(j())})},setDisableAnalyticsTracking:function(e){this.storage().set(Y.disable_analytics_tracking,!!e)},close:function(){var e=this;if(!this.options.sw&&this.session.exists())return this.storage().get(Y.opted_out).then(function(t){return t?(e.options.allowLogs&&console.log("Data collection is opted out"),Promise.reject("Data collection is opted out")):e.identity.customerId()}).then(function(t){var n={dt:"c",u:B(),ss:e.session.openTime(),su:e.session.uuid(),fl:e.session.screens(),ct:T(),ctl:e.session.actionTime()-e.session.openTime(),cta:e.session.actionTime()-e.session.openTime(),cid:t,utp:e.identity.isAnonymousUser(t)?"anonymous":"known"};return e._upload(n),e.session.destroy()})},trackPageView:function(){this.tagEvent("Page View",{URL:t.location.href,Title:b.title,Referrer:b.referrer||"Direct"})},tagScreen:function(e){var t=this;this.storage().get(Y.opted_out).then(function(n){return n?(t.options.allowLogs&&console.log("Data collection is opted out"),Promise.reject("Data collection is opted out")):void t.session.addScreen(e)})},tagEvent:function(e,t,n){var o=this;this.storage().get(Y.opted_out).then(function(e){return e?(o.options.allowLogs&&console.log("Data collection is opted out"),Promise.reject("Data collection is opted out")):o.session.updateActionTime()}).then(function(e){return o.identity.customerId()}).then(function(i){var r=o._commonData({dt:"e",n:""+e,cid:i,utp:o.identity.isAnonymousUser(i)?"anonymous":"known"});t&&"object"===u(t)?r.attrs=L({},t):"number"==typeof t&&"undefined"==typeof n&&(n=t),"number"==typeof n&&n>0&&(r.v=n),o._upload(r)})},setProfileAttribute:function(e,t,n){this.session.updateActionTime(),this._postProfile("assign",e,t,n)},deleteProfileAttribute:function(e,t){this.session.updateActionTime(),this._postProfile("delete",e,"",t)},addProfileAttributesToSet:function(e,t,n){this.session.updateActionTime(),E(t)||(t=[t]),this._postProfile("set-add",e,t,n)},savePushSubscription:function(e){try{var t=this;this.storage().get(Y.push_token).then(function(t){return t!==a.stringify(e)?e:null}).then(function(e){return e?Promise.all([t.storage().set(Y.push_token,a.stringify(e)),t.storage().set(Y.push_enabled,"granted"===Notification.permission)]):null}).then(function(e){e&&t.tagEvent("Localytics Push Registered")})}catch(n){t.options.allowLogs&&console.error(n)}},subscribeToWebPush:function(e,t){var n=this,o=function(t){return n.savePushSubscription(t),e(t)},i=this.options,r=i.publicKey,s=i.workerPath,u=i.allowLogs;return r?void d.subscribe({publicKey:r,workerPath:s,successCallback:o,failureCallback:t,allowLogs:u}):void(n.options.allowLogs&&console.log("Localytics is unable to subscribe to push - no public key has been provided."))},unsubscribeFromWebPush:function(e){d.unsubscribe({callback:e,allowLogs:this.options.allowLogs,workerPath:this.options.workerPath}),this.storage().set(Y.push_token,null),this.storage().set(Y.push_enabled,!1)},registerServiceWorker:function(e,t){var n=this.options,o=n.workerPath,i=n.workerName,r=n.allowLogs;d.registerServiceWorker({workerPath:o,workerName:i,successCallback:e,failureCallback:t,allowLogs:r})},registerPush:function(e,t){var n=this.options,o=n.workerPath,i=n.workerName,r=n.publicKey,s=n.allowLogs;if(!r)return void(this.options.allowLogs&&console.log("Localytics is unable to register for push - no public key has been provided."));var u=this;d.registerServiceWorker({workerPath:o,workerName:i,successCallback:function(n){d.subscribe({publicKey:r,workerPath:o,successCallback:function(t){u.savePushSubscription(t),h.getWebpushFeatures().then(e)},failureCallback:t,allowLogs:s})},failureCallback:t,allowLogs:s})},parseNotification:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.message,n=e.badge,i=e.dir,s=e.icon,u=e.requireInteraction,a=e.renotify,c=e.silent,l=e.ll,f=e.ll_title,p=e.ll_attachment_url,d=e.ll_deep_link_url,h=e.ll_actions,g=e.ll_push_event_attributes,m=r(e,["message","badge","dir","icon","requireInteraction","renotify","silent","ll","ll_title","ll_attachment_url","ll_deep_link_url","ll_actions","ll_push_event_attributes"]);if(!l)return{};var v=(h||[]).map(function(e){return o({},e,{action:e.deeplink})}),y={title:f||t,body:f?t:void 0,badge:n,dir:i,icon:s,requireInteraction:u,renotify:a,silent:c,tag:l.ca,image:p,actions:v,data:o({deeplink:d},m,{ll:l,labels:g,actions:v})};return this.tagEvent("Localytics Push Received",o({"Campaign ID":l.ca,"Creative ID":l.cr,"Creative Type":y.title?"Alert":"Silent","Creative Displayed":y.title?"Yes":"No","Schema Version - Client":1,"Schema Version - Server":l.v?l.v:0},g)),y},handleNotificationReceived:function(e){var t=this.parseNotification(e.data.json()),n=t.title,i=r(t,["title"]);return!!n&&(e.waitUntil(self.registration.showNotification(n,o({},i))),!0)},tagPushOpened:function(e){var t=e.notification.data,n=t.ll,i=t.labels;if(n){var r="Click",s=e.notification.actions,u=e.action;u&&(r=s.filter(function(e){return e.action===u})[0].title),this.tagEvent("Localytics Push Opened",o({"Campaign ID":n.ca,"Creative ID":n.cr,"Creative Type":n.t||"Alert",Action:r,"Schema Version - Client":1,"Schema Version - Server":n.v?n.v:0},i))}},handleNotificationOpened:function(e){this.tagPushOpened(e);var t=e.action,n=void 0===t?"":t,o=e.notification;o=void 0===o?{}:o;var i=o.data;i=void 0===i?{}:i;var r=i.deeplink,s=void 0===r?"":r,u=i.ll;if(!u)return!1;var a=self.location.origin;return e.waitUntil(clients.openWindow(n||s||a)),!0},removeProfileAttributesFromSet:function(e,t,n){this.session.updateActionTime(),E(t)||(t=[t]),this._postProfile("set-remove",e,t,n)},incrementProfileAttribute:function(e,t,n){this.session.updateActionTime(),t=V(t),t&&this._postProfile("increment",e,t,n)},decrementProfileAttribute:function(e,t,n){this.session.updateActionTime(),t=V(t),t&&(t>0&&(t*=-1),this._postProfile("increment",e,t,n))},setCustomDimension:function(e,t){if("number"==typeof e&&e<=19&&e>=0){var n=this;this.storage().getOrSet(Y.custom_dimensions,[]).then(function(o){o[e]=t,n.storage().set(Y.custom_dimensions,o)})}},setIdentifier:function(e,t){var n=this;Promise.all([this.storage().get(Y.privacy_opt_out),this.storage().getOrSet(Y.identifiers,{})]).then(function(o){o[0]&&n.options.allowLogs&&console.log("Identifier for key ".concat(e," with value ").concat(t," not set. The user is privacy opted out."));var i=o[1];t?i[e]=t:delete i[e],n.storage().set(Y.identifiers,i)})},setCustomerEmail:function(e){this.setIdentifier("customer_email",e),this.setProfileAttribute("$email",e,"org")},setCustomerFirstName:function(e){this.setIdentifier("first_name",e),this.setProfileAttribute("$first_name",e,"org")},setCustomerLastName:function(e){this.setIdentifier("last_name",e),this.setProfileAttribute("$last_name",e,"org")},setCustomerFullName:function(e){this.setIdentifier("full_name",e),this.setProfileAttribute("$full_name",e,"org")},setCustomerId:function(e){var t=this,n=this;return this.identity.customerId().then(function(o){o!==e&&t.storage().set(Y.identifiers,{}).then(function(t){e&&n.identity.setCustomerId(e)})})},setCustomerName:function(e){this.setIdentifier("customer_name",e)},setPrivacyOptedOut:function(e){var t=this;this.storage().get(Y.privacy_opt_out).then(function(n){e==n&&(t.options.allowLogs&&console.log("Privacy Opt Out status is unchanged.  Dropping duplicate privacy opt out call."),Promise.reject("Privacy Opt Out status is unchanged.  Dropping duplicate privacy opt out call.")),t.setProfileAttribute("privacy_delete",e===!0?1:0,"app"),t.setOptedOut(e),e||t.setCustomerId(t.identity.uuid())}).then(function(n){t.storage().set(Y.privacy_opt_out,e)})},setOptedOut:function(e){var t=this;Promise.all([this.storage().get(Y.opted_out),this.storage().get(Y.privacy_opt_out)]).then(function(n){return n[1]&&(t.options.allowLogs&&console.log("Setting opt out status while current user is privacy opted out is not allowed."),Promise.reject("Setting opt out status while current user is privacy opted out is not allowed.")),n[0]===e?(t.options.allowLogs&&console.log("Opt Out status is unchanged.  Dropping duplicate opt out call."),Promise.reject("Opt Out status is unchanged.  Dropping duplicate opt out call.")):t.identity.customerId()}).then(function(n){var o=t._commonData({dt:"o",out:e,cid:n,utp:t.identity.isAnonymousUser(n)?"anonymous":"known"});t.storage().set(Y.opted_out,e),t._upload(o)}),this.session.exists()&&e&&this.close()},upload:function(e){var t=this,n=[];!e||e[0]instanceof Array||(n=[e]),(this.options.autoUpload&&(this.options.autoUpload||this.options.cacheOffline)||(n=this.queue().flush(),0!==n.length))&&(this.options.useXHR?t._post(n):q(n,function(e){t._get(e)}))},clearCustomDimensions:function(){this.storage().remove(Y.custom_dimensions)},clearIdentifiers:function(){this.storage().remove(Y.identifiers)}}),X(),self.Localytics=Q}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./cookie":8,"./indexedDB":9,"./localStorage":10,"./network":12,"./shim":13,"./webpush":15,"./webpush-utils":14,"es6-promise":1,jsonify:2,uuid:7}],12:[function(e,t,n){"use strict";function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,o)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach(function(t){r(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}!function(){var e=null;"undefined"!=typeof document&&(e=document);var n=function(e){return!!(e&&e.constructor&&e.call&&e.apply)},o=function(){};o.defaults={maxFailedAttempts:3},o._enabled=!0,o._failedAttempts=0,o.get=function(t,i){if(!o._isEnabled())return n(i)&&i(),!1;if("undefined"!=typeof e){var r=e.createElement("img");r.onerror=o._onError.bind(null,i),r.src=t}else console.log("Attempting to upload with a GET request, but document is unavailable")},o.post=function(e,t,r,s,u){if(u=u||[],!o._isEnabled())return n(s)&&s(),!1;if("undefined"!=typeof fetch){var a={};u.map(function(e){a[e[0]]=e[1]}),fetch(e,{method:"POST",mode:"cors",headers:i({Accept:"application/json","Content-Type":"application/json","Content-Encoding":"UTF-8","x-upload-time":r},a),body:t}).then(function(e){o._handleResponse(e.status)},function(e){o._onError(s)})}else{var c=new XMLHttpRequest;c.open("POST",e,!0),c.setRequestHeader("Accept","application/json"),c.setRequestHeader("Content-Type","application/json"),c.setRequestHeader("Content-Encoding","UTF-8"),c.setRequestHeader("x-upload-time",r),u.map(function(e){c.setRequestHeader(e[0],e[1])}),c.timeout=0,c.onreadystatechange=function(){4===c.readyState&&o._handleResponse(c.status)},c.send(t)}},o._onError=function(e){n(e)&&e(),o._failedAttempts++,o._failedAttempts>=o.defaults.maxFailedAttempts&&(o._enabled=!1)},o._handleResponse=function(e){200==e||202==e||e>=400&&e<500?o._reset():(e>=500&&e<600||0==e)&&o._onError(failureCallback)},o._reset=function(){o._failedAttempts=0,o._enabled=!0},o._isEnabled=function(){return o._enabled},o.isEnabled=o._isEnabled,t.exports=o}()},{}],13:[function(e,t,n){"use strict";Function.prototype.bind||(Function.prototype.bind=function(e){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var t=Array.prototype.slice.call(arguments,1),n=this,o=function(){},i=function(){return n.apply(this instanceof o?this:e,t.concat(Array.prototype.slice.call(arguments)))};return this.prototype&&(o.prototype=this.prototype),i.prototype=new o,i})},{}],14:[function(e,t,n){"use strict";function o(e){return s(e)||r(e)||i()}function i(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function r(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function s(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}function u(e){var t={serviceWorkerEnabled:!1,webPushEnabled:!1,serviceWorkerRegistered:!1,swRegistration:null,subscribedToPush:!1,pushSubscription:null};return"serviceWorker"in navigator&&(t.serviceWorkerEnabled=!0),t.serviceWorkerEnabled&&"showNotification"in ServiceWorkerRegistration.prototype&&(t.webPushEnabled=!0),t.serviceWorkerEnabled?navigator.serviceWorker.getRegistration(e).then(function(e){return e&&(t.serviceWorkerRegistered=!0),t.swRegistration=e||null,t}).then(function(e){return e.swRegistration&&e.webPushEnabled?e.swRegistration.pushManager.getSubscription().then(function(t){return t&&(e.subscribedToPush=!0),e.pushSubscription=t||null,e}):e}):new Promise(function(e){return e(t)},function(e){return e(t)})}function a(e){var t="=".repeat((4-e.length%4)%4),n=(e+t).replace(/\-/g,"+").replace(/_/g,"/"),i=window.atob(n);return Uint8Array.from(o(i).map(function(e){return e.charCodeAt(0)}))}t.exports={getWebpushFeatures:u,urlBase64ToUint8Array:a}},{}],15:[function(e,t,n){"use strict";var o=e("./webpush-utils"),i=function(){},r=function(e){var t=e.allowLogs;t&&console.error("no service worker found")};"serviceWorker"in navigator?!function(){var e=function(){};e.hasServiceWorker=!0,e.registerServiceWorker=function(e){var t=e.workerPath,n=e.workerName,o=e.successCallback,r=void 0===o?i:o,s=e.failureCallback,u=void 0===s?i:s,a=e.allowLogs,c=void 0!==a&&a;navigator.serviceWorker.register(""+t+n,{scope:t}).then(function(e){r(e),c&&console.log("service worker registered")})["catch"](function(e){u({message:"unable to register service worker",error:e,workerPath:t,workerName:n}),c&&console.error("unable to register service worker",e,t,n)})},e.subscribe=function(e){var t=e.publicKey,n=e.workerPath,r=e.successCallback,s=void 0===r?i:r,u=e.failureCallback,a=void 0===u?i:u,c=e.allowLogs,l=void 0!==c&&c;o.getWebpushFeatures(n).then(function(e){var n=e.swRegistration;if(null==n||null==n.pushManager)l&&console.log("Can't reqeust Push from from service worker - service unavailable.");else switch(Notification.permission){case"default":case"granted":n.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:o.urlBase64ToUint8Array(t)}).then(function(e){s(e),l&&console.log("subscribed to push")})["catch"](function(e){a(e)});break;case"denied":l&&console.log("notifications are blocked, user must change this themselves"),a({message:"notifications are blocked, user must change this themselves"})}})},e.unsubscribe=function(e){var t=e.callback,n=void 0===t?i:t,r=e.allowLogs,s=void 0!==r&&r,u=e.workerPath;o.getWebpushFeatures(u).then(function(e){var t=e.pushSubscription;return t?void t.unsubscribe().then(function(){n({message:"service worker unsubscribed"}),s&&console.log("service worker unsubscribed")}):(n({message:"already not subscribed"}),void(s&&console.log("already not subscribed")))})},t.exports=e}():t.exports={hasServiceWorker:!1,registerServiceWorker:r,subscribe:r,unsubscribe:r}},{"./webpush-utils":14}]},{},[11]);